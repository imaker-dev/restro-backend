{
  "info": {
    "name": "RestroPOS - Permission APIs",
    "description": "## Complete Permission Management API Collection\n\n### Manager Permissions (58 total)\n\n**Tables (6):** TABLE_VIEW, TABLE_CREATE, TABLE_EDIT, TABLE_DELETE, TABLE_MERGE, TABLE_TRANSFER\n\n**Orders (6):** ORDER_VIEW, ORDER_CREATE, ORDER_MODIFY, ORDER_CANCEL, ORDER_VOID, ORDER_REOPEN\n\n**KOT (4):** KOT_SEND, KOT_MODIFY, KOT_CANCEL, KOT_REPRINT\n\n**Billing (4):** BILL_VIEW, BILL_GENERATE, BILL_REPRINT, BILL_CANCEL\n\n**Payment (3):** PAYMENT_COLLECT, PAYMENT_REFUND, PAYMENT_SPLIT\n\n**Discounts (6):** DISCOUNT_APPLY, DISCOUNT_REMOVE, DISCOUNT_CUSTOM, TAX_MODIFY, SERVICE_CHARGE_MODIFY, TIP_ADD\n\n**Items (7):** ITEM_VIEW, ITEM_CREATE, ITEM_EDIT, ITEM_DELETE, ITEM_CANCEL, ITEM_PRICING, ITEM_AVAILABILITY\n\n**Categories (4):** CATEGORY_VIEW, CATEGORY_CREATE, CATEGORY_EDIT, CATEGORY_DELETE\n\n**Inventory (4):** INVENTORY_VIEW, INVENTORY_EDIT, INVENTORY_ADJUST, INVENTORY_TRANSFER\n\n**Staff (5):** STAFF_VIEW, STAFF_CREATE, STAFF_EDIT, STAFF_DELETE, STAFF_PERMISSIONS\n\n**Reports (5):** REPORT_VIEW, REPORT_SALES, REPORT_INVENTORY, REPORT_STAFF, REPORT_EXPORT\n\n**Layout (2):** FLOOR_VIEW, SECTION_VIEW\n\n**Printers (1):** PRINTER_VIEW\n\n**Settings (1):** SETTINGS_VIEW\n\n### Permission Rules\n- Admin is superuser (has ALL permissions)\n- Manager can only grant permissions they have\n- Captain permissions assigned by Admin or Manager",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {"key": "baseUrl", "value": "http://localhost:3000/api/v1"},
    {"key": "adminToken", "value": ""},
    {"key": "managerToken", "value": ""},
    {"key": "captainToken", "value": ""},
    {"key": "outletId", "value": "1"},
    {"key": "managerId", "value": ""},
    {"key": "captainId", "value": ""},
    {"key": "managerRoleId", "value": "3"},
    {"key": "captainRoleId", "value": "4"},
    {"key": "managerEmployeeCode", "value": ""},
    {"key": "captainEmployeeCode", "value": ""}
  ],
  "item": [
    {
      "name": "0. Setup",
      "description": "Setup tokens and test users",
      "item": [
        {
          "name": "0.1 Admin Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.success) {",
                  "  pm.collectionVariables.set('adminToken', res.data.accessToken);",
                  "}",
                  "pm.test('Admin login successful', () => pm.expect(res.success).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"email\": \"admin@restropos.com\",\n  \"password\": \"admin123\"\n}"},
            "url": "{{baseUrl}}/auth/login"
          }
        },
        {
          "name": "0.2 Get Roles",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.success) {",
                  "  const roles = res.data;",
                  "  const manager = roles.find(r => r.slug === 'manager');",
                  "  const captain = roles.find(r => r.slug === 'captain');",
                  "  if (manager) pm.collectionVariables.set('managerRoleId', manager.id);",
                  "  if (captain) pm.collectionVariables.set('captainRoleId', captain.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}],
            "url": "{{baseUrl}}/users/roles"
          }
        },
        {
          "name": "0.3 Create Test Manager",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.success) {",
                  "  pm.collectionVariables.set('managerId', res.data.id);",
                  "  pm.collectionVariables.set('managerEmployeeCode', res.data.employeeCode);",
                  "}",
                  "pm.test('Manager created with 58 permissions', () => {",
                  "  pm.expect(res.success).to.be.true;",
                  "  pm.expect(res.data.permissionCount).to.equal(58);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"name\": \"Permission Test Manager\",\n  \"email\": \"perm.mgr.{{$timestamp}}@test.com\",\n  \"employeeCode\": \"PMG{{$timestamp}}\",\n  \"password\": \"Manager@123\",\n  \"pin\": \"1234\",\n  \"isActive\": true,\n  \"roles\": [{\"roleId\": {{managerRoleId}}, \"outletId\": {{outletId}}}]\n}"},
            "url": "{{baseUrl}}/users"
          }
        },
        {
          "name": "0.4 Manager Login (PIN)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.success) {",
                  "  pm.collectionVariables.set('managerToken', res.data.accessToken);",
                  "}",
                  "pm.test('Manager PIN login successful', () => pm.expect(res.success).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"employeeCode\": \"{{managerEmployeeCode}}\",\n  \"pin\": \"1234\",\n  \"outletId\": {{outletId}}\n}"},
            "url": "{{baseUrl}}/auth/login/pin"
          }
        },
        {
          "name": "0.5 Create Test Captain",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.success) {",
                  "  pm.collectionVariables.set('captainId', res.data.id);",
                  "  pm.collectionVariables.set('captainEmployeeCode', res.data.employeeCode);",
                  "}",
                  "pm.test('Captain created with 22 permissions', () => {",
                  "  pm.expect(res.success).to.be.true;",
                  "  pm.expect(res.data.permissionCount).to.equal(22);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"name\": \"Permission Test Captain\",\n  \"employeeCode\": \"PCP{{$timestamp}}\",\n  \"pin\": \"5678\",\n  \"isActive\": true,\n  \"roles\": [{\"roleId\": {{captainRoleId}}, \"outletId\": {{outletId}}}]\n}"},
            "url": "{{baseUrl}}/users"
          }
        },
        {
          "name": "0.6 Captain Login (PIN)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.success) {",
                  "  pm.collectionVariables.set('captainToken', res.data.accessToken);",
                  "}",
                  "pm.test('Captain PIN login successful', () => pm.expect(res.success).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"employeeCode\": \"{{captainEmployeeCode}}\",\n  \"pin\": \"5678\",\n  \"outletId\": {{outletId}}\n}"},
            "url": "{{baseUrl}}/auth/login/pin"
          }
        }
      ]
    },
    {
      "name": "1. Get All Permissions",
      "description": "GET /permissions - Retrieve all available permissions",
      "item": [
        {
          "name": "1.1 Get All Permissions (Admin)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has permissions array', () => pm.expect(res.data.permissions).to.be.an('array'));",
                  "pm.test('Has grouped object', () => pm.expect(res.data.grouped).to.be.an('object'));",
                  "pm.test('Has 100+ permissions', () => pm.expect(res.data.permissions.length).to.be.above(100));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}],
            "url": "{{baseUrl}}/permissions",
            "description": "Get all available permissions in the system, grouped by category."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"permissions\": [\n      {\"id\": 1, \"name\": \"View Tables\", \"slug\": \"TABLE_VIEW\", \"module\": \"tables\", \"category\": \"tables\"},\n      {\"id\": 2, \"name\": \"Create Tables\", \"slug\": \"TABLE_CREATE\", \"module\": \"tables\", \"category\": \"tables\"}\n    ],\n    \"grouped\": {\n      \"tables\": [{\"id\": 1, \"slug\": \"TABLE_VIEW\"}, ...],\n      \"orders\": [{\"id\": 7, \"slug\": \"ORDER_VIEW\"}, ...]\n    }\n  }\n}"
            }
          ]
        },
        {
          "name": "1.2 Get All Permissions (Manager)",
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{managerToken}}"}],
            "url": "{{baseUrl}}/permissions"
          }
        }
      ]
    },
    {
      "name": "2. Get My Permissions",
      "description": "GET /permissions/my - Get current user's permissions",
      "item": [
        {
          "name": "2.1 Admin Permissions (Superuser)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Admin is superuser', () => pm.expect(res.data.isSuperuser).to.be.true);",
                  "pm.test('Has all permissions', () => pm.expect(res.data.permissions.length).to.be.above(100));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}],
            "url": "{{baseUrl}}/permissions/my",
            "description": "Admin is a superuser and has ALL permissions."
          },
          "response": [
            {
              "name": "Success - Superuser",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"isSuperuser\": true,\n    \"permissions\": [\"TABLE_VIEW\", \"TABLE_CREATE\", ...all permissions...],\n    \"permissionDetails\": [...]\n  }\n}"
            }
          ]
        },
        {
          "name": "2.2 Manager Permissions (58)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Not superuser', () => pm.expect(res.data.isSuperuser).to.be.false);",
                  "pm.test('Has 58 permissions', () => pm.expect(res.data.permissions.length).to.equal(58));",
                  "",
                  "// Verify key permissions",
                  "const perms = res.data.permissions;",
                  "pm.test('Has TABLE_VIEW', () => pm.expect(perms).to.include('TABLE_VIEW'));",
                  "pm.test('Has ORDER_CREATE', () => pm.expect(perms).to.include('ORDER_CREATE'));",
                  "pm.test('Has STAFF_PERMISSIONS', () => pm.expect(perms).to.include('STAFF_PERMISSIONS'));",
                  "pm.test('Does NOT have OUTLET_SETTINGS', () => pm.expect(perms).to.not.include('OUTLET_SETTINGS'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{managerToken}}"}],
            "url": "{{baseUrl}}/permissions/my",
            "description": "Manager has 58 specific permissions."
          },
          "response": [
            {
              "name": "Success - Manager",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"isSuperuser\": false,\n    \"permissions\": [\n      \"TABLE_VIEW\", \"TABLE_CREATE\", \"TABLE_EDIT\", \"TABLE_DELETE\", \"TABLE_MERGE\", \"TABLE_TRANSFER\",\n      \"ORDER_VIEW\", \"ORDER_CREATE\", \"ORDER_MODIFY\", \"ORDER_CANCEL\", \"ORDER_VOID\", \"ORDER_REOPEN\",\n      \"KOT_SEND\", \"KOT_MODIFY\", \"KOT_CANCEL\", \"KOT_REPRINT\",\n      \"BILL_VIEW\", \"BILL_GENERATE\", \"BILL_REPRINT\", \"BILL_CANCEL\",\n      \"PAYMENT_COLLECT\", \"PAYMENT_REFUND\", \"PAYMENT_SPLIT\",\n      \"DISCOUNT_APPLY\", \"DISCOUNT_REMOVE\", \"DISCOUNT_CUSTOM\", \"TAX_MODIFY\", \"SERVICE_CHARGE_MODIFY\", \"TIP_ADD\",\n      \"ITEM_VIEW\", \"ITEM_CREATE\", \"ITEM_EDIT\", \"ITEM_DELETE\", \"ITEM_CANCEL\", \"ITEM_PRICING\", \"ITEM_AVAILABILITY\",\n      \"CATEGORY_VIEW\", \"CATEGORY_CREATE\", \"CATEGORY_EDIT\", \"CATEGORY_DELETE\",\n      \"INVENTORY_VIEW\", \"INVENTORY_EDIT\", \"INVENTORY_ADJUST\", \"INVENTORY_TRANSFER\",\n      \"STAFF_VIEW\", \"STAFF_CREATE\", \"STAFF_EDIT\", \"STAFF_DELETE\", \"STAFF_PERMISSIONS\",\n      \"REPORT_VIEW\", \"REPORT_SALES\", \"REPORT_INVENTORY\", \"REPORT_STAFF\", \"REPORT_EXPORT\",\n      \"FLOOR_VIEW\", \"SECTION_VIEW\",\n      \"PRINTER_VIEW\",\n      \"SETTINGS_VIEW\"\n    ]\n  }\n}"
            }
          ]
        },
        {
          "name": "2.3 Captain Permissions (22)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has 22 permissions', () => pm.expect(res.data.permissions.length).to.equal(22));",
                  "",
                  "const perms = res.data.permissions;",
                  "pm.test('Has TABLE_VIEW', () => pm.expect(perms).to.include('TABLE_VIEW'));",
                  "pm.test('Has ORDER_CREATE', () => pm.expect(perms).to.include('ORDER_CREATE'));",
                  "pm.test('Does NOT have ORDER_VOID', () => pm.expect(perms).to.not.include('ORDER_VOID'));",
                  "pm.test('Does NOT have STAFF_DELETE', () => pm.expect(perms).to.not.include('STAFF_DELETE'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{captainToken}}"}],
            "url": "{{baseUrl}}/permissions/my",
            "description": "Captain has 22 limited permissions."
          },
          "response": [
            {
              "name": "Success - Captain",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"isSuperuser\": false,\n    \"permissions\": [\n      \"TABLE_VIEW\", \"TABLE_MERGE\", \"TABLE_TRANSFER\",\n      \"ORDER_VIEW\", \"ORDER_CREATE\", \"ORDER_MODIFY\",\n      \"KOT_SEND\", \"KOT_MODIFY\", \"KOT_REPRINT\",\n      \"BILL_VIEW\", \"BILL_GENERATE\", \"BILL_REPRINT\",\n      \"PAYMENT_COLLECT\", \"PAYMENT_SPLIT\",\n      \"DISCOUNT_APPLY\", \"TIP_ADD\",\n      \"ITEM_VIEW\", \"ITEM_CANCEL\",\n      \"CATEGORY_VIEW\",\n      \"FLOOR_VIEW\", \"SECTION_VIEW\",\n      \"PRINTER_VIEW\"\n    ]\n  }\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "3. Grantable Permissions",
      "description": "GET /permissions/grantable - Permissions user can grant",
      "item": [
        {
          "name": "3.1 Manager Grantable (58)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Can grant 58 permissions', () => pm.expect(res.data.permissions.length).to.equal(58));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{managerToken}}"}],
            "url": "{{baseUrl}}/permissions/grantable",
            "description": "Manager can only grant permissions they have (58)."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"permissions\": [\"TABLE_VIEW\", \"TABLE_CREATE\", ...58 permissions...],\n    \"canGrantAll\": false\n  }\n}"
            }
          ]
        },
        {
          "name": "3.2 Admin Grantable (All)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Admin can grant all', () => pm.expect(res.data.permissions.length).to.be.above(100));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}],
            "url": "{{baseUrl}}/permissions/grantable",
            "description": "Admin can grant ALL permissions."
          }
        }
      ]
    },
    {
      "name": "4. Check Permission",
      "description": "POST /permissions/check - Verify specific permissions",
      "item": [
        {
          "name": "4.1 Check Single Permission",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Permission granted', () => pm.expect(res.data.granted).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{managerToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"permission\": \"ORDER_CREATE\"\n}"},
            "url": "{{baseUrl}}/permissions/check",
            "description": "Check if current user has a specific permission."
          },
          "response": [
            {
              "name": "Success - Has Permission",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"permission\": \"ORDER_CREATE\",\n    \"granted\": true\n  }\n}"
            }
          ]
        },
        {
          "name": "4.2 Check Permission NOT Granted",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Permission denied', () => pm.expect(res.data.granted).to.be.false);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{managerToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"permission\": \"OUTLET_SETTINGS\"\n}"},
            "url": "{{baseUrl}}/permissions/check",
            "description": "Manager does NOT have OUTLET_SETTINGS permission."
          },
          "response": [
            {
              "name": "Success - No Permission",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"permission\": \"OUTLET_SETTINGS\",\n    \"granted\": false\n  }\n}"
            }
          ]
        },
        {
          "name": "4.3 Check Multiple Permissions",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('ORDER_CREATE granted', () => pm.expect(res.data.permissions.ORDER_CREATE).to.be.true);",
                  "pm.test('BILL_GENERATE granted', () => pm.expect(res.data.permissions.BILL_GENERATE).to.be.true);",
                  "pm.test('OUTLET_SETTINGS denied', () => pm.expect(res.data.permissions.OUTLET_SETTINGS).to.be.false);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{managerToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"permissions\": [\"ORDER_CREATE\", \"BILL_GENERATE\", \"OUTLET_SETTINGS\"]\n}"},
            "url": "{{baseUrl}}/permissions/check",
            "description": "Check multiple permissions at once. Returns object with each permission's status."
          },
          "response": [
            {
              "name": "Success - Multiple",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"permissions\": {\n      \"ORDER_CREATE\": true,\n      \"BILL_GENERATE\": true,\n      \"OUTLET_SETTINGS\": false\n    },\n    \"isSuperuser\": false\n  }\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "5. Role Permissions",
      "description": "GET /permissions/roles/:id - Default permissions for a role",
      "item": [
        {
          "name": "5.1 Get Manager Role Permissions",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has 58 permissions', () => pm.expect(res.data.length).to.equal(58));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}],
            "url": "{{baseUrl}}/permissions/roles/{{managerRoleId}}",
            "description": "Get default permissions assigned to manager role."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": [\n    {\"id\": 1, \"name\": \"View Tables\", \"slug\": \"TABLE_VIEW\", \"category\": \"tables\"},\n    {\"id\": 2, \"name\": \"Create Tables\", \"slug\": \"TABLE_CREATE\", \"category\": \"tables\"},\n    ... 58 total ...\n  ]\n}"
            }
          ]
        },
        {
          "name": "5.2 Get Captain Role Permissions",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has 22 permissions', () => pm.expect(res.data.length).to.equal(22));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}],
            "url": "{{baseUrl}}/permissions/roles/{{captainRoleId}}",
            "description": "Get default permissions assigned to captain role."
          }
        }
      ]
    },
    {
      "name": "6. User Permissions",
      "description": "GET /users/:id/permissions - Get specific user's permissions",
      "item": [
        {
          "name": "6.1 Get Captain User Permissions",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has permissions array', () => pm.expect(res.data.permissions).to.be.an('array'));",
                  "pm.test('Has 22 permissions', () => pm.expect(res.data.permissions.length).to.equal(22));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}],
            "url": "{{baseUrl}}/users/{{captainId}}/permissions",
            "description": "Get a specific user's current permissions."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": {\n    \"isSuperuser\": false,\n    \"permissions\": [\"TABLE_VIEW\", \"ORDER_CREATE\", ...22 permissions...]\n  }\n}"
            }
          ]
        },
        {
          "name": "6.2 Manager Views Captain Permissions",
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{managerToken}}"}],
            "url": "{{baseUrl}}/users/{{captainId}}/permissions",
            "description": "Manager can view captain's permissions."
          }
        }
      ]
    },
    {
      "name": "7. Grant Permissions",
      "description": "POST /users/:id/permissions/grant - Add permissions to user",
      "item": [
        {
          "name": "7.1 Manager Grants ORDER_CANCEL",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Grant successful or already has', () => {",
                  "  pm.expect(res.success || res.message.includes('already')).to.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{managerToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"permissions\": [\"ORDER_CANCEL\"],\n  \"reason\": \"Granting order cancel permission for testing\"\n}"},
            "url": "{{baseUrl}}/users/{{captainId}}/permissions/grant",
            "description": "Manager grants a permission they have to captain."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"message\": \"Permissions granted successfully\",\n  \"data\": {\n    \"granted\": [\"ORDER_CANCEL\"],\n    \"skipped\": []\n  }\n}"
            }
          ]
        },
        {
          "name": "7.2 Manager Grants Multiple Permissions",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Grant successful', () => pm.expect(res.success).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{managerToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"permissions\": [\"ORDER_VOID\", \"BILL_CANCEL\", \"PAYMENT_REFUND\"],\n  \"reason\": \"Granting additional permissions to senior captain\"\n}"},
            "url": "{{baseUrl}}/users/{{captainId}}/permissions/grant",
            "description": "Grant multiple permissions at once."
          }
        },
        {
          "name": "7.3 Manager BLOCKED from OUTLET_SETTINGS",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Should be blocked', () => pm.expect(res.success).to.be.false);",
                  "pm.test('Error mentions OUTLET_SETTINGS', () => pm.expect(res.message).to.include('OUTLET_SETTINGS'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{managerToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"permissions\": [\"OUTLET_SETTINGS\"],\n  \"reason\": \"This should fail - manager doesn't have this permission\"\n}"},
            "url": "{{baseUrl}}/users/{{captainId}}/permissions/grant",
            "description": "Manager CANNOT grant permissions they don't have."
          },
          "response": [
            {
              "name": "Error - Forbidden",
              "status": "Forbidden",
              "code": 403,
              "body": "{\n  \"success\": false,\n  \"message\": \"You cannot grant permissions you don't have: OUTLET_SETTINGS\"\n}"
            }
          ]
        },
        {
          "name": "7.4 Admin Grants OUTLET_SETTINGS",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Admin can grant any permission', () => pm.expect(res.success).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"permissions\": [\"OUTLET_SETTINGS\"],\n  \"reason\": \"Admin granting outlet settings to captain\"\n}"},
            "url": "{{baseUrl}}/users/{{captainId}}/permissions/grant",
            "description": "Admin can grant ANY permission."
          }
        }
      ]
    },
    {
      "name": "8. Revoke Permissions",
      "description": "POST /users/:id/permissions/revoke - Remove permissions from user",
      "item": [
        {
          "name": "8.1 Admin Revokes OUTLET_SETTINGS",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Revoke successful', () => pm.expect(res.success).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"permissions\": [\"OUTLET_SETTINGS\"],\n  \"reason\": \"Revoking outlet settings from captain\"\n}"},
            "url": "{{baseUrl}}/users/{{captainId}}/permissions/revoke",
            "description": "Revoke specific permissions from user."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"message\": \"Permissions revoked successfully\",\n  \"data\": {\n    \"revoked\": [\"OUTLET_SETTINGS\"]\n  }\n}"
            }
          ]
        },
        {
          "name": "8.2 Revoke Multiple Permissions",
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"permissions\": [\"ORDER_VOID\", \"BILL_CANCEL\"],\n  \"reason\": \"Removing elevated permissions\"\n}"},
            "url": "{{baseUrl}}/users/{{captainId}}/permissions/revoke"
          }
        }
      ]
    },
    {
      "name": "9. Set Permissions (Replace All)",
      "description": "PUT /users/:id/permissions - Replace all user permissions",
      "item": [
        {
          "name": "9.1 Admin Sets Custom Permissions",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Set successful', () => pm.expect(res.success).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}, {"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\n  \"permissions\": [\n    \"TABLE_VIEW\",\n    \"ORDER_VIEW\",\n    \"ORDER_CREATE\",\n    \"BILL_VIEW\",\n    \"BILL_GENERATE\"\n  ],\n  \"reason\": \"Setting minimal permissions for restricted captain\"\n}"},
            "url": "{{baseUrl}}/users/{{captainId}}/permissions",
            "description": "Replace ALL user permissions with a new set. This removes any permissions not in the list."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"message\": \"Permissions updated successfully\",\n  \"data\": {\n    \"permissions\": [\"TABLE_VIEW\", \"ORDER_VIEW\", \"ORDER_CREATE\", \"BILL_VIEW\", \"BILL_GENERATE\"]\n  }\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "10. Permission History",
      "description": "GET /users/:id/permissions/history - Audit log",
      "item": [
        {
          "name": "10.1 Get Permission History",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has history array', () => pm.expect(res.data).to.be.an('array'));",
                  "pm.test('Has entries', () => pm.expect(res.data.length).to.be.above(0));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}],
            "url": "{{baseUrl}}/users/{{captainId}}/permissions/history",
            "description": "Get audit log of all permission changes for a user."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"data\": [\n    {\n      \"id\": 1,\n      \"changed_by\": 1,\n      \"changed_by_name\": \"Admin User\",\n      \"target_user_id\": 70,\n      \"action\": \"grant\",\n      \"permission_ids\": [15, 20],\n      \"old_permissions\": [\"TABLE_VIEW\"],\n      \"new_permissions\": [\"TABLE_VIEW\", \"ORDER_CANCEL\"],\n      \"reason\": \"Granting additional permissions\",\n      \"created_at\": \"2026-02-04T05:00:00.000Z\"\n    }\n  ]\n}"
            }
          ]
        },
        {
          "name": "10.2 Get History with Limit",
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}],
            "url": {
              "raw": "{{baseUrl}}/users/{{captainId}}/permissions/history?limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{captainId}}", "permissions", "history"],
              "query": [{"key": "limit", "value": "10"}]
            },
            "description": "Get limited history entries."
          }
        }
      ]
    },
    {
      "name": "11. Cleanup",
      "item": [
        {
          "name": "11.1 Delete Test Captain",
          "request": {
            "method": "DELETE",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}],
            "url": "{{baseUrl}}/users/{{captainId}}"
          }
        },
        {
          "name": "11.2 Delete Test Manager",
          "request": {
            "method": "DELETE",
            "header": [{"key": "Authorization", "value": "Bearer {{adminToken}}"}],
            "url": "{{baseUrl}}/users/{{managerId}}"
          }
        }
      ]
    }
  ]
}
